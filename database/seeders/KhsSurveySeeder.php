<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Illuminate\Support\Str;
use App\Models\Witel;
use App\Models\Sto;
use App\Models\Bundle;
use App\Models\Subpaket;
use App\Models\Pricing;

class KhsSurveySeeder extends Seeder
{
    public function run(): void
    {
        $bundle = Bundle::where('name', 'KHS New Sales (KU) + Survey')->firstOrFail();

        $subpakets = [
            '0P to 1P FO' => Subpaket::where('bundle_id', $bundle->id)->where('name', '0P to 1P FO')->firstOrFail(),
            '0P to 2P FO' => Subpaket::where('bundle_id', $bundle->id)->where('name', '0P to 2P FO')->firstOrFail(),
            '0P to 3P FO' => Subpaket::where('bundle_id', $bundle->id)->where('name', '0P to 3P FO')->firstOrFail(),
        ];

        // Data asli dari kamu
        $rows = <<<DATA
1	BDG	BDK	437871	320998	437871	320998	437871	344091
2	BDG	CCD	437871	320998	437871	320998	437871	344091
3	BDG	CJA	437871	320998	437871	320998	437871	344091
4	BDG	DGO	437871	320998	437871	320998	437871	344091
5	BDG	GGK	437871	320998	437871	320998	437871	344091
6	BDG	HGM	437871	320998	437871	320998	437871	344091
7	BDG	LBG	437871	320998	437871	320998	437871	344091
8	BDG	SMD	437871	320998	437871	320998	437871	344091
9	BDG	TAS	437871	320998	437871	320998	437871	344091
10	BDG	TLE	437871	320998	437871	320998	437871	344091
11	BDG	TRG	437871	320998	437871	320998	437871	344091
12	BDG	UBR	437871	320998	437871	320998	437871	344091
13	BDB	BJA	437871	320998	437871	320998	437871	344091
14	BDB	BTJ	437871	320998	437871	320998	437871	344091
15	BDB	CCL	437871	320998	437871	320998	437871	344091
16	BDB	CKW	437871	320998	437871	320998	437871	344091
17	BDB	CLL	437871	320998	437871	320998	437871	344091
18	BDB	CMI	437871	320998	437871	320998	437871	344091
19	BDB	CPT	437871	320998	437871	320998	437871	344091
20	BDB	CSA	437871	320998	437871	320998	437871	344091
21	BDB	CWD	437871	320998	437871	320998	437871	344091
22	BDB	GNH	437871	320998	437871	320998	437871	344091
23	BDB	LEM	437871	320998	437871	320998	437871	344091
24	BDB	MJY	437871	320998	437871	320998	437871	344091
25	BDB	NJG	437871	320998	437871	320998	437871	344091
26	BDB	PDL	437871	320998	437871	320998	437871	344091
27	BDB	PNL	437871	320998	437871	320998	437871	344091
28	BDB	RCK	437871	320998	437871	320998	437871	344091
29	BDB	RJW	437871	320998	437871	320998	437871	344091
30	BDB	SOR	437871	320998	437871	320998	437871	344091
31	CBN	AWN	437871	213559	437871	213559	437871	228923
32	CBN	BON	437871	213559	437871	213559	437871	228923
33	CBN	CBN	437871	213559	437871	213559	437871	228923
34	CBN	CKC	437871	213559	437871	213559	437871	228923
35	CBN	CKI	437871	213559	437871	213559	437871	228923
36	CBN	CKY	437871	213559	437871	213559	437871	228923
37	CBN	CLI	437871	213559	437871	213559	437871	228923
38	CBN	HAR	437871	213559	437871	213559	437871	228923
39	CBN	IMY	437871	213559	437871	213559	437871	228923
40	CBN	JBN	437871	213559	437871	213559	437871	228923
41	CBN	JTB	437871	213559	437871	213559	437871	228923
42	CBN	JTW	437871	213559	437871	213559	437871	228923
43	CBN	KAD	437871	213559	437871	213559	437871	228923
44	CBN	KNG	437871	213559	437871	213559	437871	228923
45	CBN	KRM	437871	213559	437871	213559	437871	228923
46	CBN	LOS	437871	213559	437871	213559	437871	228923
47	CBN	LSR	437871	213559	437871	213559	437871	228923
48	CBN	MJL	437871	213559	437871	213559	437871	228923
49	CBN	PAB	437871	213559	437871	213559	437871	228923
50	CBN	PRD	437871	213559	437871	213559	437871	228923
51	CBN	PTR	437871	213559	437871	213559	437871	228923
52	CBN	RGA	437871	213559	437871	213559	437871	228923
53	CBN	SDU	437871	213559	437871	213559	437871	228923
54	KWA	CAS	437871	385764	437871	385764	437871	413517
55	KWA	CBU	437871	385764	437871	385764	437871	413517
56	KWA	CKP	437871	385764	437871	385764	437871	413517
57	KWA	CLM	437871	385764	437871	385764	437871	413517
58	KWA	CPL	437871	385764	437871	385764	437871	413517
59	KWA	JCG	437871	385764	437871	385764	437871	413517
60	KWA	JTS	437871	385764	437871	385764	437871	413517
61	KWA	KIA	437871	385764	437871	385764	437871	413517
62	KWA	KLI	437871	385764	437871	385764	437871	413517
63	KWA	KRW	437871	385764	437871	385764	437871	413517
64	KWA	PBS	437871	385764	437871	385764	437871	413517
65	KWA	PGD	437871	385764	437871	385764	437871	413517
66	KWA	PLD	437871	385764	437871	385764	437871	413517
67	KWA	PMN	437871	385764	437871	385764	437871	413517
68	KWA	PWK	437871	385764	437871	385764	437871	413517
69	KWA	RDK	437871	385764	437871	385764	437871	413517
70	KWA	SUB	437871	385764	437871	385764	437871	413517
71	KWA	TLJ	437871	385764	437871	385764	437871	413517
72	KWA	WDS	437871	385764	437871	385764	437871	413517
73	SKB	BGL	437871	268132	437871	268132	437871	287422
74	SKB	CBD	437871	268132	437871	268132	437871	287422
75	SKB	CBE	437871	268132	437871	268132	437871	287422
76	SKB	CCR	437871	268132	437871	268132	437871	287422
77	SKB	CJG	437871	268132	437871	268132	437871	287422
78	SKB	CJR	437871	268132	437871	268132	437871	287422
79	SKB	CKB	437871	268132	437871	268132	437871	287422
80	SKB	CKK	437871	268132	437871	268132	437871	287422
81	SKB	CMO	437871	268132	437871	268132	437871	287422
82	SKB	JPK	437871	268132	437871	268132	437871	287422
83	SKB	KLU	437871	268132	437871	268132	437871	287422
84	SKB	NLD	437871	268132	437871	268132	437871	287422
85	SKB	PLR	437871	268132	437871	268132	437871	287422
86	SKB	SDL	437871	268132	437871	268132	437871	287422
87	SKB	SGA	437871	268132	437871	268132	437871	287422
88	SKB	SGN	437871	268132	437871	268132	437871	287422
89	SKB	SKB	437871	268132	437871	268132	437871	287422
90	SKB	SKM	437871	268132	437871	268132	437871	287422
91	SKB	TGE	437871	268132	437871	268132	437871	287422
92	TSM	BJS	437871	220322	437871	220322	437871	236172
93	TSM	BNJ	437871	220322	437871	220322	437871	236172
94	TSM	CBL	437871	220322	437871	220322	437871	236172
95	TSM	CBT	437871	220322	437871	220322	437871	236172
96	TSM	CIW	437871	220322	437871	220322	437871	236172
97	TSM	CKJ	437871	220322	437871	220322	437871	236172
98	TSM	CMS	437871	220322	437871	220322	437871	236172
99	TSM	GRU	437871	220322	437871	220322	437871	236172
100	TSM	KAW	437871	220322	437871	220322	437871	236172
101	TSM	KDN	437871	220322	437871	220322	437871	236172
102	TSM	KNU	437871	220322	437871	220322	437871	236172
103	TSM	LAG	437871	220322	437871	220322	437871	236172
104	TSM	MLB	437871	220322	437871	220322	437871	236172
105	TSM	MNJ	437871	220322	437871	220322	437871	236172
106	TSM	PAX	437871	220322	437871	220322	437871	236172
107	TSM	PMP	437871	220322	437871	220322	437871	236172
108	TSM	RJP	437871	220322	437871	220322	437871	236172
109	TSM	SPA	437871	220322	437871	220322	437871	236172
110	TSM	TSM	437871	220322	437871	220322	437871	236172
111	TSM	WNR	437871	220322	437871	220322	437871	236172
DATA;

        foreach (explode("\n", $rows) as $line) {
            $cols = preg_split('/\s+/', trim($line));
            if (count($cols) < 9) continue;

            [$no, $witelCode, $stoCode, $mat1, $jasa1, $mat2, $jasa2, $mat3, $jasa3] = $cols;

            $witel = Witel::firstOrCreate(
                ['name' => $witelCode],
                ['id' => Str::uuid()]
            );

            $sto = Sto::firstOrCreate(
                ['name' => $stoCode],
                ['id' => Str::uuid(), 'witel_id' => $witel->id]
            );

            Pricing::create([
                'id' => Str::uuid(),
                'witel_id' => $witel->id,
                'sto_id' => $sto->id,
                'subpaket_id' => $subpakets['0P to 1P FO']->id,
                'material_price' => $mat1,
                'jasa_price' => $jasa1
            ]);

            Pricing::create([
                'id' => Str::uuid(),
                'witel_id' => $witel->id,
                'sto_id' => $sto->id,
                'subpaket_id' => $subpakets['0P to 2P FO']->id,
                'material_price' => $mat2,
                'jasa_price' => $jasa2
            ]);

            Pricing::create([
                'id' => Str::uuid(),
                'witel_id' => $witel->id,
                'sto_id' => $sto->id,
                'subpaket_id' => $subpakets['0P to 3P FO']->id,
                'material_price' => $mat3,
                'jasa_price' => $jasa3
            ]);
        }
    }
}
